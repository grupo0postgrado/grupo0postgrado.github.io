<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Bike Availability Prediction</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="css/clean-blog.min.css" rel="stylesheet">
    <link href="css/clean-blog.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
          type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
          rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-bars"></i>
            </button>
            <a class="navbar-brand" href="index.html">Blog Grupo 0</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#processing">Processing</a>
                </li>
                <li>
                    <a href="#enrichment">Enrichment</a>
                </li>
                <li>
                    <a href="#explore">Exploration</a>
                </li>
                <li>
                    <a href="#prediction">Prediction</a>
                </li>
                <li>
                    <a href="#cases">Study Cases</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header">
    <img class="header-background" src="img/portada_bicing.jpg"/>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Bike Availability Prediction</h1>
                    <h2 class="subheading">Introduction to Data Science and Machine Learning</h2>
                    <span class="meta">Universitat de Barcelona, 26 de junio 2024</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>The purpose of this research is to predict the percentage of free docks based on the historical
                    data from each <a href="https://www.bicing.barcelona/">Bicing</a> station, a bicycle-sharing system
                    in Barcelona, Spain.</p>
                <p>The data used for the prediction was obtained from <a
                        href="https://opendata-ajuntament.barcelona.cat/">Open Data BCN</a>, providing information on
                    the number of bikes and available docks per station between 2020 and 2023. Additionally,
                    station-specific information such as the total number of docks and their coordinates was included
                    from <a href="https://drive.google.com/file/d/1MRBWDKh6D5773FfoJYv6vHKBCC1TasVO/view">this file</a>.
                </p>
                <h3 class="section-heading" id="processing">Processing</h3>
                <p>The project used Python for development, emphasizing the handling of large datasets with <a
                        href="https://www.dask.org/">Dask</a>. Dask was selected for its capability to process data
                    larger than available memory by parallelizing operations across multiple cores or distributed
                    computing clusters, providing substantial performance benefits over traditional tools like pandas.
                </p>
                <p>Firstly, a Dask DataFrame was created by concatenating raw records from all available months of data,
                    spanning from January 2020 to December 2023. Below are the initial records from this DataFrame:</p>
                <div style="overflow-x:auto;">
                    <table class="dataframe">
                        <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>station_id</th>
                            <th>num_bikes_available</th>
                            <th>num_bikes_available_types.mechanical</th>
                            <th>num_bikes_available_types.ebike</th>
                            <th>num_docks_available</th>
                            <th>last_reported</th>
                            <th>is_charging_station</th>
                            <th>status</th>
                            <th>is_installed</th>
                            <th>is_renting</th>
                            <th>is_returning</th>
                            <th>last_updated</th>
                            <th>ttl</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th>0</th>
                            <td>1.0</td>
                            <td>38.0</td>
                            <td>35.0</td>
                            <td>3.0</td>
                            <td>8</td>
                            <td>1672527561</td>
                            <td>True</td>
                            <td>IN_SERVICE</td>
                            <td>1.0</td>
                            <td>1.0</td>
                            <td>1</td>
                            <td>1.672528e+09</td>
                            <td>19.0</td>
                        </tr>
                        <tr>
                            <th>1</th>
                            <td>2.0</td>
                            <td>6.0</td>
                            <td>5.0</td>
                            <td>1.0</td>
                            <td>23</td>
                            <td>1672527391</td>
                            <td>True</td>
                            <td>IN_SERVICE</td>
                            <td>1.0</td>
                            <td>1.0</td>
                            <td>1</td>
                            <td>1.672528e+09</td>
                            <td>19.0</td>
                        </tr>
                        <tr>
                            <th>2</th>
                            <td>3.0</td>
                            <td>20.0</td>
                            <td>20.0</td>
                            <td>0.0</td>
                            <td>7</td>
                            <td>1672527440</td>
                            <td>True</td>
                            <td>IN_SERVICE</td>
                            <td>1.0</td>
                            <td>1.0</td>
                            <td>1</td>
                            <td>1.672528e+09</td>
                            <td>19.0</td>
                        </tr>
                        <tr>
                            <th>3</th>
                            <td>4.0</td>
                            <td>19.0</td>
                            <td>19.0</td>
                            <td>0.0</td>
                            <td>2</td>
                            <td>1672527516</td>
                            <td>True</td>
                            <td>IN_SERVICE</td>
                            <td>1.0</td>
                            <td>1.0</td>
                            <td>1</td>
                            <td>1.672528e+09</td>
                            <td>19.0</td>
                        </tr>
                        <tr>
                            <th>4</th>
                            <td>5.0</td>
                            <td>4.0</td>
                            <td>3.0</td>
                            <td>1.0</td>
                            <td>35</td>
                            <td>1672527342</td>
                            <td>True</td>
                            <td>IN_SERVICE</td>
                            <td>1.0</td>
                            <td>1.0</td>
                            <td>1</td>
                            <td>1.672528e+09</td>
                            <td>19.0</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <p>Next, the records were filtered to keep only the stations in service, and data transformation
                    began.</p>
                <p>Initially, the data was processed year by year, identifying discrepancies where records within a year
                    did not correspond to the year being processed, which led to their exclusion. Subsequently, the hour
                    from the <i>'last_reported'</i> column was extracted, and the percentage of free docks
                    (<i>'pct_free_docks'</i>) was computed using the columns <i>'num_docks_available'</i> and <i>'num_bikes_available'</i>.
                    This resulted in a new dataframe where data was grouped to calculate the average free docks per
                    station-hour.</p>
                <p>Finally, fields for the percentage of free docks from each of the previous 4 hours per record were
                    added, along with date-related columns formatted to match the required output format for prediction.
                    This process generated a <i>{year}_processed_file.csv</i> for every year with the processed data, as
                    shown below:</p>
                <div style="overflow-x:auto;">
                    <table class="dataframe">
                        <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>station_id</th>
                            <th>sum_date</th>
                            <th>pct_free_docks</th>
                            <th>year</th>
                            <th>month</th>
                            <th>day</th>
                            <th>hour</th>
                            <th>ct1</th>
                            <th>ct2</th>
                            <th>ct3</th>
                            <th>ct4</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th>0</th>
                            <td>52.0</td>
                            <td>2023-01-01 02:00:00</td>
                            <td>0.341667</td>
                            <td>2023</td>
                            <td>1</td>
                            <td>1</td>
                            <td>2</td>
                            <td>0.347222</td>
                            <td>0.423563</td>
                            <td>0.267337</td>
                            <td>0.266667</td>
                        </tr>
                        <tr>
                            <th>1</th>
                            <td>52.0</td>
                            <td>2023-01-01 07:00:00</td>
                            <td>0.483333</td>
                            <td>2023</td>
                            <td>1</td>
                            <td>1</td>
                            <td>7</td>
                            <td>0.552778</td>
                            <td>0.558333</td>
                            <td>0.527778</td>
                            <td>0.466667</td>
                        </tr>
                        <tr>
                            <th>2</th>
                            <td>52.0</td>
                            <td>2023-01-01 12:00:00</td>
                            <td>0.417720</td>
                            <td>2023</td>
                            <td>1</td>
                            <td>1</td>
                            <td>12</td>
                            <td>0.408333</td>
                            <td>0.444444</td>
                            <td>0.486111</td>
                            <td>0.483333</td>
                        </tr>
                        <tr>
                            <th>3</th>
                            <td>52.0</td>
                            <td>2023-01-01 17:00:00</td>
                            <td>0.239559</td>
                            <td>2023</td>
                            <td>1</td>
                            <td>1</td>
                            <td>17</td>
                            <td>0.286111</td>
                            <td>0.266667</td>
                            <td>0.327778</td>
                            <td>0.344444</td>
                        </tr>
                        <tr>
                            <th>4</th>
                            <td>52.0</td>
                            <td>2023-01-01 22:00:00</td>
                            <td>0.591667</td>
                            <td>2023</td>
                            <td>1</td>
                            <td>1</td>
                            <td>22</td>
                            <td>0.586111</td>
                            <td>0.516667</td>
                            <td>0.433333</td>
                            <td>0.348276</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <p>These dataframes, grouped by station-hour and separated by year, allow for easier manipulation. For
                    training the models, data from 2021 and 2022 was used, while data from 2023 was reserved for
                    validation. The year 2020 was excluded due to its significantly different behavior compared to the
                    other years, as detailed in the Exploration section below.</p>
                <p>Station-specific data was also added to incorporate geographical and operational details for each
                    station. Additional datasets believed to provide valuable insights into analyzing dock availability
                    patterns were included as well. These contributions will be elaborated upon in detail in the
                    Enrichment section.</p>

                <h3 class="section-heading" id="enrichment">Enrichment</h3>
                <p>Firstly, additional time-related columns were incorporated, including:
                <ul>
                    <li>Day of the week</li>
                    <li>Time of day (Morning, Afternoon, Evening, Night)</li>
                </ul>
                </p>
                <p>Additionally, a column indicating public holidays was added, using the public <a
                        href="https://opendata-ajuntament.barcelona.cat/data/en/dataset/calendari-festes-laborals">holiday
                    calendar of Catalonia</a>. This was based on the hypothesis that Bicing bikes usage strongly depends
                    on time of day and work/school days.</p>
                <p>Furthermore, to enrich the dataset with more geographical information, columns related to
                    neighborhoods were included, sourced from <a
                            href="https://opendata-ajuntament.barcelona.cat/data/es/dataset/20170706-districtes-barris">Open
                        Data BCN</a>. These additions are presumed to provide insights into different usage patterns
                    across geographic areas.</p>
                <p>Lastly, weather information from <a href="https://www.meteo.cat/">meteo.cat</a> was included to
                    supplement the dataset with climatic conditions, which are believed to significantly influence bikes
                    usage. The inclusion of weather data aims to understand if and how conditions like rain impact
                    Bicing usage patterns.</p>
                <p>To enrich the dataset, scikit-learn pipelines were used. This approach allowed for the consistent and
                    efficient application of all data transformations, scaling of numerical features, encoding and
                    addition of new time-related and geographical columns to any other dataset with the same input
                    format. It simplified the workflow and ensured reproducibility.</p>
                <p>Firstly, a merging pipeline was created to add all the attributes believed to enhance prediction
                    accuracy. This pipeline also included a step to discard records with null values, ensuring that the
                    dataset remains clean and reliable for analysis. Secondly, an encoding pipeline was defined. For
                    categorical variables, One-Hot Encoding was used, while for numerical variables, a SimpleImputer
                    with a median replacement strategy and a StandardScaler were applied to ensure comparability of
                    attributes.</p>
                <p>With these two pipelines, a dataset of 95 attributes was generated for training predictive models.
                    These variables correspond to the encoding of the following original features:</p>
                <ul>
                    <li>Day of the week</li>
                    <li>Holiday indicator</li>
                    <li>Time of day</li>
                    <li>Month</li>
                    <li>Neighborhood</li>
                    <li>Percentage of free docks from 1 to 4 hours before</li>
                    <li>Average temperature</li>
                    <li>Average relative humidity</li>
                    <li>Precipitation</li>
                    <li>Solar radiation</li>
                    <li>Average wind speed</li>
                </ul>
                <h3 class="section-heading" id="explore">Exploration</h3>
                <p>As background, it is important to note that between March 14, 2020, and June 21, 2020, Spain entered
                    a state of lockdown due to the <a
                            href="https://es.wikipedia.org/wiki/Confinamiento_por_la_pandemia_de_COVID-19_en_Espa%C3%B1a">COVID-19
                        pandemic</a>. This period is evident in the graph below, where the trend for free docks follows
                    a similar pattern for other years, with an increase from the beginning of the year until the start
                    of the summer season. However, during the lockdown months in 2020, there is a significant decrease.
                </p>
                <img class="img-responsive" src="img/covid_2020.jpg" alt="">
                <span class="caption text-muted">Monthly comparison of the percentage of free docks between 2020-2023</span>
                <p>Due to the outlier behavior during the 2020 lockdown, where data significantly deviates from other
                    years, the 2020 data was excluded from model training. This ensures the predictive models are not
                    skewed by pandemic-related anomalies.</p>
                <h3 class="section-heading" id="prediction">Prediction</h3>
                <h3 class="subsection-heading">Linear regression</h3>
                <p>Firstly, a simple linear regression was developed. The following graph represents the absolute values
                    of the coefficients for each attribute based on the training data:</p>
                <img class="img-responsive" src="img/coefs_lin_reg.jpg" alt="">
                <span class="caption text-muted">Linear regression absolute value coefficients</span>
                <p>The most significant attributes for the model, as anticipated, are the percentages of free docks from
                    the two preceding hours, underscoring the strong temporal correlation between past and future
                    availability. Additionally, several neighborhoods emerge as important factors, indicating a
                    geographical relationship with bike usage patterns. Conversely, the regression assigns minimal
                    importance to meteorological data. This suggests that weather effects might be indirectly captured
                    within the autoregressive variables, reducing their direct impact on the model.</p>
                <p>Next, when testing the trained model on the validation data, the following performance metrics were
                    obtained:</p>
                <blockquote>R^2 Score: 0.8375777661567385<br>
                    RMSE: 0.11281038105252036
                </blockquote>
                <h3 class="section-heading" id="cases">Study Cases</h3>
                <h3 class="subsection-heading">E-bikes distribution</h3>
                <p>One topic meriting further exploration is the geographic distribution of electric bikes across
                    different time frames. To facilitate this analysis, the most recent 2023 data was reprocessed to
                    include columns detailing the mean number of electric and mechanical bikes.</p>
                <p>Using <a href="https://altair.com/">Altair</a>, a Python library to create concise and interactive
                    visualizations, a series of map plots were crafted to illustrate the distribution of electric bikes
                    across various zones in Barcelona. Each visualization comprises four distinct maps, corresponding to
                    different times of the day: morning, afternoon, evening, and night. Additionally, these plots can be
                    filtered by season and type of day, distinguishing between workdays and holidays.</p>
                <iframe class="charts" src="img/ebikes_interactive.html" width="100%" height="1000px"></iframe>
                <span class="caption text-muted">Average number of ebikes by neighborhood/time of day - interactive filter by day type/season </span>
                <p>Parallel visualizations were generated for the average number of mechanical bikes, highliting the
                    contrasting geographic distribution patterns between electric and mechanical bikes.</p>
                <iframe class="charts" src="img/mechbikes_interactive.html" width="100%" height="1000px"></iframe>
                <span class="caption text-muted">Average number of mechanical bikes by neighborhood/time of day - interactive filter by day type/season </span>
                <p>To narrow down the exploration of ebikes, further analysis focused on the working days of the summer
                    period, which shows significant contrasts. As the map of illustrates, while the afternoon
                    distribution is fairly even, in the evening, electric bikes tend to concentrate in higher-altitude,
                    primarily residential areas such as Camp d'en Grassot i Gràcia Nova, El Guinardó and El Baix
                    Guinardó. This leaves central and coastal zones with electric bike values lower than one.</p>
                <p>Moreover, neighborhoods with the fewest electric bikes during the evening and night in summer were
                    identified via filtering: El Barri Gòtic, Sant Pere, Santa Caterina i la Ribera, La Vila Olímpica
                    del Poblenou and La Barceloneta. Additionally, 20% stations with the least electric bikes
                    available for the given season were visualized on the following map.</p>
                <iframe class="charts" src="img/least_ebikes.html" width="100%" height="1000px"></iframe>
                <span class="caption text-muted">20% of stations with the least ebikes in summer by time of the day</span>
                <p>Next, linear plots were employed to illustrate the patterns within these specific neighborhoods and
                    to pinpoint peak hours with a dearth of ebikes. Despite the variations in hourly patterns across
                    zones, it is observed a low average number of bikes, fewer than two per station, for every station
                    and season, starting at 18:00 hrs. And particularly, for the summer season the average number is
                    lower than one ebike at every station since 20:00 hrs</p>
                <img class="img-responsive" src="img/least_ebikes_stations.jpg" alt="">
                <span class="caption text-muted">Mean number of ebikes by season-hour for the neighborhoods with the fewest ebikes during the summer evenings and nights</span>
                <p>From this preliminary investigation, we propose enhancing the distribution of electric bikes for
                    selected areas during the summer months. For example, reserving a specific number of bikes
                    exclusively for the time frame beginning at 20:00. This strategy would enable users to access
                    electric bicycles for returning to high-altitude neighborhoods in the evening and particularly at
                    night, when other public transportation services are reduced.</p>
            </div>
        </div>
    </div>
</article>

<hr>

<!-- Footer -->
<footer>
    <div class="container">
    </div>
</footer>

<!-- jQuery -->
<script src="vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Theme JavaScript -->
<script src="js/clean-blog.min.js"></script>

</body>

</html>
